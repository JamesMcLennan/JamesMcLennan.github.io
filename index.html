<!DOCTYPE html>
<html lang="en">
<head>
    <link href='https://fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Istok+Web' rel='stylesheet' type='text/css'>
    <link href="https://fonts.googleapis.com/css?family=Cabin" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/master.css">
	<title>CS</title>
    <script>
    var counter = 0;
    var refNum;
    var list = document.getElementById("savedDeets");
    var lastid = 0;

    function createLink() {

      var texto = this.redir.value;
      var textod = texto.replace(/^CRS/, '');
      var integered = parseInt(textod, 16);
      var errMsg = "The reference number is not in correct format. Please check the number, and try again...";
      var errMsg2 = "Assistance!: All InQuba Reference numbers will contain CRS as the first three letters.";
      var errMsg3 = "Assistance!: Generally InQuba Reference numbers will be 9 characters long.";
      var errMsg4 = "Assistance!: Please seek advice from CS.";

      if (texto.includes("CRS") && texto.length == 9) {
      document.getElementById("ErrorMessage").innerHTML = "";
      document.getElementById("CRSAssist").innerHTML = "";
      document.getElementById("CRSAssist2").innerHTML = "";
      document.getElementById("CRSAssist3").innerHTML = "";
      document.getElementById("CRSLink").innerHTML = texto;
      document.getElementById("CRSLink").href = "https://village.inqubacx.com/CEMS/#/Incident/" + integered;
      document.getElementById("CRSLink").target ="_main";
      document.getElementById("CRSLink").className ="button1";
      document.getElementById("offerSave").innerHTML = "Do you want to save the current reference number?";
      document.getElementById("confirmSave").style.display = "block";
      counter = 0;
      refNum = texto;

      if(lastid == 0) {
        document.getElementById("savedRefNums").style.display = "none";
      }
      else {
        document.getElementById("savedRefNums").style.display = "block"; 
      }
    }
    
    else {
      document.getElementById("ErrorMessage").innerHTML = errMsg.bold().fontcolor("#d9e006");
      document.getElementById("CRSLink").innerHTML = "";
      document.getElementById("offerSave").innerHTML = "";
      document.getElementById("confirmSave").style.display = "none";
      counter++;
      if (counter > 1 || !texto.includes("CRS")) {
        document.getElementById("CRSAssist").innerHTML = errMsg2.bold().fontcolor("#d9e006");
      }
      if (counter > 2 || texto.length != 9) {
        document.getElementById("CRSAssist2").innerHTML = errMsg3.bold().fontcolor("#d9e006");
      }
      if (counter > 3) {
        document.getElementById("CRSAssist3").innerHTML = errMsg4.bold().fontcolor("#d9e006");
      }
    }
  }

  function saveLink() {
    document.getElementById("fullName").innerHTML = "Comments:";
    document.getElementById("fnTextBox").style.display = "block";
    document.getElementById("saveButton").style.display = "block";
    document.getElementById("offerSave").innerHTML = "";
    document.getElementById("confirmSave").style.display = "none";
  }

  function saved() {
    var fName = this.fnTextBox.value;
    var entry = document.createElement('li');
    var list = document.getElementById("savedDeets");
    entry.appendChild(document.createTextNode(fName + " - " + refNum + " "));
    entry.setAttribute('id', 'item'+lastid);

    var removeButton = document.createElement('button');
    removeButton.appendChild(document.createTextNode("Remove"));

    removeButton.setAttribute('onClick','removeRef("'+'item'+lastid+'")');
    removeButton.setAttribute('class','button');

    entry.appendChild(removeButton);
    lastid++;
    list.appendChild(entry);

    document.getElementById("fullName").innerHTML = "";
    document.getElementById("fnTextBox").style.display = "none";
    document.getElementById("saveButton").style.display = "none";
    document.getElementById("offerSave").innerHTML = "";
    document.getElementById("confirmSave").style.display = "none";
    
    if(lastid == 1) {
        document.getElementById("savedRefNums").style.display = "block";
    }

  }

  function removeRef(itemid) { 
   var list = document.getElementById("savedDeets");
   var item = document.getElementById(itemid);
   list.removeChild(item);
   lastid--;
   if(lastid == 0) {
        document.getElementById("savedRefNums").style.display = "none";
    }
 }

</script>
</head>
<body>
    <div class="wrapper">
        <div class="divback">
            <p>Written and Coded by James McLennan - 2017</p>
        </div>
        <nav class="nav"> 
            <div class="divbackorange"> 
                <ul>
                    <li class="li"><a class="active" href="index.html">Home</a></li>
                    <li class="li"><a href="#">Installation Guide</a></li>
                </ul>
            </div>
        </nav>
        <div class="CRSLoader">
            <h1 class="title">CRS Loader</h1>
            <form id="test">
            <b id="red">
              <input type="text" id="redir" name="redir"/>
              <button type="button" onclick="createLink()" class="button">Create Link</button>
              <a id="CRSLink" href="#"></a>
            </b>

            <a id="CRSLink" href="#"></a>
            <p id="ErrorMessage"></p>
            <p id="CRSAssist"></p>
            <p id="CRSAssist2"></p>
            <p id="CRSAssist3"></p>

            <p id="offerSave"></p>

            <button type="button" onclick="saveLink()" id="confirmSave" style="display:none" class="button">Yes</button>

            <form id="contactDetails">
              <b id="red1">
                <p id ="fullName"></p>
                <input type="text" id="fnTextBox" name="fnTextBox" style="display:none"/><button type="button" id="saveButton" style="display:none" onclick="saved()" class="button">Save</button>
              </b>
            </form>

            <div class= "savedRefNums" id="savedRefNums" style="display:none;">
              <h2>Saved Reference Numbers</h2>
              <ol id="savedDeets"></ol>
            </div>
        </div>
        <div class="CRSLoader">
            <h1 class="title">CRS Creator</h1>
            <a href="https://village.inqubacx.com/CEMS/#/Incident/" class="button">Create Issue</a>
        </div>
        <div class="push"></div>
    </div>
</body>
<footer class ="footer">
</footer>
</html>